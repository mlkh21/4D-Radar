# ==============================================================================
# 4D Radar Diffusion & Consistency Models - Configuration File
# ==============================================================================

# --- Data Configuration ---
data:
  dataset_dir: "./NTU4DRadLM_pre_processing/NTU4DRadLM_Pre"
  batch_size: 2
  num_workers: 4
  train_split: 0.8
  alignment_size: 32
  use_augmentation: true
  augmentation:
    flip_prob: 0.5
    rotate_prob: 0.3
    noise_prob: 0.2
    noise_std: 0.02

# --- VAE Configuration ---
vae:
  # Config type: ultra_lightweight / lightweight / standard
  config_type: "ultra_lightweight"
  in_channels: 4
  out_channels: 4
  latent_dim: 4
  kl_weight: 1.0e-6
  # Training parameters
  epochs: 100
  lr: 1.0e-4
  save_every: 10
  save_dir: "./diffusion_consistency_radar/train_results/vae"
  
# --- Latent Diffusion Model Configuration ---
ldm:
  # Model architecture
  model_channels: 32
  channel_mult: [1, 2, 3]
  num_res_blocks: 1
  attention_resolutions: []  # Disable attention to save memory
  # Diffusion parameters (Karras)
  sigma_data: 0.5
  sigma_max: 80.0
  sigma_min: 0.002
  rho: 7.0
  # Training parameters
  epochs: 200
  lr: 1.0e-4
  save_every: 5000
  save_dir: "./diffusion_consistency_radar/train_results/ldm"

# --- Consistency Distillation Configuration ---
cd:
  # Distillation from LDM to CD model
  teacher_model_path: ""  # LDM checkpoint path
  # Distillation parameters
  training_mode: "consistency_distillation"
  target_ema_mode: "fixed"
  start_ema: 0.95
  scale_mode: "fixed"
  start_scales: 40
  end_scales: 40
  total_training_steps: 100000
  distill_steps_per_iter: 50000
  loss_norm: "l2"  # l1 / l2 / lpips
  # Training parameters
  lr: 5.0e-5
  save_every: 20000
  save_dir: "./diffusion_consistency_radar/train_results/cd"

# --- Optimization Configuration ---
optimization:
  use_amp: false  # Mixed precision training (disabled due to type mismatch in VAE)
  gradient_accumulation_steps: 8
  use_checkpoint: true  # Gradient checkpointing
  use_fp16: false  # FP16 model weights
  max_grad_norm: 1.0

# --- Hardware Configuration ---
hardware:
  device: "cuda"
  num_gpus: 2

# --- Logging Configuration ---
logging:
  log_interval: 100
  save_samples: true
  sample_interval: 1000
  tensorboard: true
  wandb: false
